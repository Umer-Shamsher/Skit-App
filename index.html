// Import necessary libraries
import { useState, useEffect } from 'react';
import { Button } from "@/components/ui/button";
import { Tabs, TabsList, TabsTrigger, TabsContent } from "@/components/ui/tabs";
import Confetti from 'react-confetti';
import { motion } from 'framer-motion';

// Constants
const students = [
  "Fiza ghouri", "Komal", "Vaniza", "Rafey Mengal", "Kumail", "Mustafa", "Hadi", "Aleeshba",
  "Zaeema", "Areeba", "Zahra", "Baneen", "Rohail", "Hunain", "Shayma", "Muneeb", "Noman",
  "Sabeen", "Fatima", "Areeba", "Sana", "Alishba", "Tasbiha", "Suman", "Anoosha", "Bisma",
  "Zaid", "Arham Nadia", "Rasheed", "Suhaira Tanveer", "Parvez Ali", "Hammad Uddin", "Hamza Anwar",
  "Abdul moiz", "M ali", "Fazal", "Wasil fadli", "Abdul Rafay Rauf", "Asjad Taha", "Aazmir Qureshi",
  "Umer", "Touqeer Shahid", "Ammad Khan", "Anus"
];

const hardTasks = [
  { en: "Say the tongue twister 'Trois tortues trottent' three times.", fr: "Dis le virelangue 'Trois tortues trottent' trois fois." },
  { en: "Act out the sentence 'Je dors' (I am sleeping).", fr: "Mime la phrase 'Je dors'." },
  { en: "Say any two dialogues in French. First in original, then in French.", fr: "Dis deux rÃ©pliques en franÃ§ais. D'abord en langue originale, puis en franÃ§ais." }
];

const easyTasks = [
  { en: "Say the French word for 'red, mango, Balloon'.", fr: "Dis le mot franÃ§ais pour 'rouge, mangue, Ballon'." },
  { en: "Name three animals in French.", fr: "Nomme trois animaux en franÃ§ais." },
  { en: "Say the phrase 'Bonjour, comment Ã§a va ?' (Hello, how are you?)", fr: "Dis la phrase 'Bonjour, comment Ã§a va ?'" },
  { en: "Conjugate the verb 'Ãªtre' in the present tense.", fr: "Conjugue le verbe 'Ãªtre' au prÃ©sent." },
  { en: "Name a famous French landmark.", fr: "Nomme un monument franÃ§ais cÃ©lÃ¨bre." },
  { en: "Translate 'I love Pakistan' into French.", fr: "Traduis 'I love Pakistan' en franÃ§ais." }
];

// Helper Functions
const getRandomStudent = (usedStudents) => {
  const available = students.filter(s => !usedStudents.includes(s));
  return available[Math.floor(Math.random() * available.length)];
};

const getRandomTask = (type, usedTasks) => {
  const pool = type === 'hard' ? hardTasks : easyTasks;
  const available = pool.filter(t => !usedTasks.includes(t.en));
  return available[Math.floor(Math.random() * available.length)];
};

export default function FrenchGameShow() {
  const [section, setSection] = useState('demo');
  const [usedStudents, setUsedStudents] = useState([]);
  const [drawnStudent, setDrawnStudent] = useState(null);
  const [confetti, setConfetti] = useState(false);
  const [usedTasks, setUsedTasks] = useState([]);
  const [currentTask, setCurrentTask] = useState(null);
  const [taskType, setTaskType] = useState('easy');
  const [timer, setTimer] = useState(40);

  const spinStudent = () => {
    const student = getRandomStudent(usedStudents);
    setDrawnStudent(student);
    setUsedStudents([...usedStudents, student]);
    setConfetti(true);
    setTimeout(() => setConfetti(false), 5000);
  };

  const assignTask = (type) => {
    setTaskType(type);
    const task = getRandomTask(type, usedTasks);
    setCurrentTask(task);
    setUsedTasks([...usedTasks, task.en]);
  };

  useEffect(() => {
    let interval = null;
    if (timer > 0) {
      interval = setInterval(() => setTimer(t => t - 1), 1000);
    }
    return () => clearInterval(interval);
  }, [timer]);

  return (
    <div className="p-4 bg-yellow-50 min-h-screen">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">ğŸ® French Game Show</h1>
        <Button onClick={() => setSection(section === 'demo' ? 'game' : 'demo')}>
          Switch to {section === 'demo' ? 'Game' : 'Demo'}
        </Button>
      </div>

      {confetti && <Confetti />}

      {section === 'demo' && (
        <div className="mt-6">
          <h2 className="text-xl font-semibold mb-2">Demo: Audience Wheel ğŸ¡</h2>
          <Button onClick={spinStudent}>Spin the Wheel</Button>
          {drawnStudent && (
            <motion.div animate={{ scale: [1, 1.2, 1] }} className="mt-4 text-lg font-bold">
              ğŸ‰ Lucky Draw Winner: {drawnStudent}
            </motion.div>
          )}
        </div>
      )}

      {section === 'game' && (
        <Tabs defaultValue="draw" className="mt-6">
          <TabsList>
            <TabsTrigger value="draw">ğŸ¯ Lucky Draw</TabsTrigger>
            <TabsTrigger value="task">ğŸ“‹ Tasks</TabsTrigger>
          </TabsList>

          <TabsContent value="draw">
            <Button onClick={spinStudent}>Spin the Audience Wheel</Button>
            {drawnStudent && <p className="mt-3 text-xl font-bold">ğŸ‰ {drawnStudent}</p>}
          </TabsContent>

          <TabsContent value="task">
            <div className="flex gap-4 mt-3">
              <Button onClick={() => assignTask('easy')}>Easy Task</Button>
              <Button onClick={() => assignTask('hard')}>Hard Task</Button>
            </div>
            {currentTask && (
              <div className="mt-4 bg-white p-4 rounded-xl shadow-md">
                <p><strong>EN:</strong> {currentTask.en}</p>
                <p><strong>FR:</strong> {currentTask.fr}</p>
              </div>
            )}
          </TabsContent>
        </Tabs>
      )}

      <div className="mt-6 text-center">
        <p className="text-sm">â±ï¸ Time Left: <span className="font-bold">{timer}s</span></p>
        {timer === 0 && <p className="text-red-600 font-bold mt-2">â›” Time's Up!</p>}
      </div>
    </div>
  );
}
